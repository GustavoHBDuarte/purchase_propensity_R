---
title: "purchase_propensity_2"
author: "Gustavo Duarte"
date: "`r Sys.Date()`"
output: html_document
---

# Installing Packages

```{r}
install.packages("tidyverse")
install.packages("janitor")
```

# Import libraries

```{r}
library(tidyverse)
library(readr) # leitura de arquivos .csv
library(janitor) # nomes de colunas em caixa baixa e espaços em _
```

# Loading data

```{r}
df <- read_csv("train.csv")
#View(df)
dplyr::glimpse(df)
```

# Data checking, cleaning and description

```{r}
# Checking first rows
df %>% head
```

```{r}
# lowering and standardizing column names
df <- janitor::clean_names(df)

df %>% head
```

```{r}
# Data types
dplyr::tibble(features = colnames(df), 
              data_tipe = unlist(lapply(df, typeof))
              )
```

```{r}
# 1 - Replacing some column names (rename() function)

# 2 - Changing categorical columns elements to lowercase

# 3 - Changing 'vehicle_age' column values

# função mutate: nome da variável, operação a fazer na variável
# função across: aplica uma função à multiplas colunas

df <- df %>% 
  
  # renomear colunas -> rename(nome_novo, nome_antigo)
  dplyr::rename(days_associated = vintage,
                health_annual_paid = annual_premium) %>% 
  
  # mutate(nome_da_variável, operacao)
  dplyr::mutate(
    
                across(where(is.character), tolower),
                
                driving_license = ifelse(driving_license==1, "yes", "no"),
                
                previously_insured = ifelse(previously_insured==1, "yes", "no"),
                
                response = ifelse(response==1, "yes", "no"),
                
                vehicle_age = case_when(
                                        vehicle_age == "< 1 year" ~ "less_than_1_year",
                                        vehicle_age == "1-2 year" ~ "between_1_and_2_years",
                                        vehicle_age == "> 2 years" ~ "more_than_1_year"
                                        )
    
               ) %>% 
  
  # convertendo variáveis de caracter p/ factor
  dplyr::mutate_if(is.character, as.factor)
  

```

```{r}
# Response variable:

# Setting "yes" as first level in "response" column

df[['response']] <- factor(df[['response']], levels=c("yes", "no"))
```

```{r}
# Saving df as rds file
base::saveRDS(df, "df_cleaned.rds")
```

```{r}
# Check df

df
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
