---
title: "purchase_propensity_2"
author: "Gustavo Duarte"
date: "`r Sys.Date()`"
output: html_document
---

# 0.0 - Installing Packages

```{r}
install.packages("tidyverse")
install.packages("janitor")
```

# 0.1 - Import libraries

```{r}
library(tidyverse)
library(readr) # leitura de arquivos .csv
library(janitor) # nomes de colunas em caixa baixa e espaços em _
```

# 0.2 - Loading data

```{r}
df <- readr::read_csv("train.csv")
#View(df)
#dplyr::glimpse(df)
df %>% head
```

# 1.0 - Data checking, cleaning and description

```{r}
# Checking first rows
df %>% head
```

```{r}
# Colocando nome das colunas em caixa baixa
df <- janitor::clean_names(df)

df %>% head
```

```{r}
# Data types

dplyr::tibble(features = colnames(df), 
              data_tipe = unlist(lapply(df, typeof))
              )
```

```{r}
# Data dimensions


dplyr::tibble( dimension = unlist(list("rows", "columns")),
               count = c(dim(df)[1], dim(df)[2]))
```

```{r}
# Checking NA's

dplyr::tibble(variable = colnames(df),
              number_of_missing = colSums(is.na(df)))
```

```{r}
# 1 - Replacing some column names (rename() function)

# 2 - Changing categorical columns elements to lowercase

# 3 - Changing 'vehicle_age' column values

# função mutate: nome da variável, operação a fazer na variável
# função across: aplica uma função à multiplas colunas

df <- df %>% 
  
  # renomear colunas -> rename(nome_novo, nome_antigo)
  dplyr::rename(days_associated = vintage,
                health_annual_paid = annual_premium) %>% 
  
  # mutate(nome_da_variável, operacao)
  dplyr::mutate(
    
                # colunas categóricas -> valores em lowercase
                across(where(is.character), tolower),
                
                # colunas com valores 1 ou 0 -> substituir por "yes" ou "no"
                
                driving_license = ifelse(driving_license==1, "yes", "no"),
                
                previously_insured = ifelse(previously_insured==1, "yes", "no"),
                
                response = ifelse(response==1, "yes", "no"),
                
                # coluna "vehicle_age" -> substituindo os valores
                vehicle_age = case_when(
                                        vehicle_age == "< 1 year" ~ "less_than_1_year",
                                        vehicle_age == "1-2 year" ~ "between_1_and_2_years",
                                        vehicle_age == "> 2 years" ~ "more_than_1_year"
                                        )
    
               ) %>% 
  
  # convertendo variáveis de caracter p/ factor
  dplyr::mutate_if(is.character, as.factor)
  

```

```{r}
# Response variable:

# Ajustando a variável resposta para fator ordenado -> "yes" no primeiro nível

df <- df %>% mutate(response = factor(response, levels=c("yes", "no")))
```

```{r}
# Contando a quantidade de "yes" e "no" na variável resposta após a conversão p/ factor ord

df$response %>% table
```

```{r}
# Saving df as rds file
base::saveRDS(df, "df_cleaned.rds")
```

```{r}
# Loading RDS file
df <- base::readRDS("df_cleaned.rds")

df %>% head
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
